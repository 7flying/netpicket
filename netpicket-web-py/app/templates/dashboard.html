{% extends "base.html" %}
{% import  "bootstrap/wtf.html" as wtf %}

{% block nexttoicon %}<strong>Netpicket</strong> - <small>{{current_user.email}}</small>{% endblock %}

{% block page_content %}
<div class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <ul class=flashes>
    {% for category, message in messages %}
    <div class="{{ category }}" role="alert">{{ message }}</div>
    {% endfor %}
  </ul>
  {% endif %}
  {% endwith %}
  <ul class="nav nav-tabs">
    <li role="presentation"
        {% if section == 'timeline' %}
        class="active"
        {% endif %}
        >
      <a href="{{url_for('dashboard', section='timeline', id='default')}}"
         rel="tooltip" title="The latest events of your networks"
         data-placement="bottom">
        <span><i class="fa fa-clock-o"></i></span> Timeline</a>
    </li>
    <li role="presentation"
        {% if section == 'alerts' %}
        class="active"
        {% endif %}
        >
      <a href="{{url_for('dashboard', section='alerts', id='default')}}"
         rel="tooltip" title="Detailed info of your timeline events"
         data-placement="bottom">
        <span><i class="fa fa-exclamation-circle"></i></span>
        Alerts</a>
    </li>
    <li role="presentation"
        {% if section == 'networks' %}
        class="active"
        {% endif %}
        >
      <a href="{{url_for('dashboard', section='networks', id='default')}}"
         rel="tooltip" title="Handle your networks"
         data-placement="bottom">
        <span><i class="fa fa-wifi"></i></span> My networks
      </a>
    </li>
    <li role="presentation"
        {% if section == 'wblists' %}
        class="active"
        {% endif %}
        >
      <a href="{{url_for('dashboard', section='wblists', id='default')}}"
         rel="tooltip" title="Manage access control lists"
         data-placement="bottom">
        <span><i class="fa fa-file"></i></span> White/Black lists
      </a>
    </li>
    <li role="presentation"
        {% if section == 'scans' %}
        class="active"
        {% endif %}
        >
      <a href="{{url_for('dashboard', section='scans', id='default')}}"
         data-placement="bottom" rel="tooltip"
         title="Schedule network scans">
        <span><i class="fa fa-flash"></i></span> Scans
      </a>
    </li>
    <li role="presentation"
        {% if section == 'stats' %}
        class="active"
        {% endif %}
        >
      <a href="{{url_for('dashboard', section='stats', id='default')}}"
         data-placement="bottom" rel="tooltip"
         title="Statistics!">
        <span><i class="fa fa-bar-chart"></i></span> Stats
      </a>
    </li>
  </ul>
  <!-- end menu -->

  
  <div class="col-md-12 col-sm-12 col-xs-12">
    {% if section == 'timeline' %}
    <!-- TIMELINE -->
    {% if events.keys()|length == 0 %}
    <br>
    <div class="alert alert-info" role="alert">
      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
      <span class="sr-only">Hey! You don't have events</span><strong>No activity! </strong>
      We haven't registered any activity.
    </div>
    {% else %}
    <h4><small><strong>UPDATED AT: </strong>
        <strong id="updated-ago">{{events[lastkey][0]['day']
          ~ ' ' ~ events[lastkey][0]['time']}}</strong>
    </small></h4>
    <br>
    <dl class="dl-horizontal" id="timeline-updates">
      {% if events.keys()|length > 0 %}
      {% for date in events.keys()|sort(reverse=True) %}
      <dt id="{{date}}">{{events[date][0]['day']}}</dt>
      <dd id="{{date ~ '-dd'}}">
        <table class="table">
          <tbody id="{{date ~ '-table'}}">
            {% for even in events[date] %}
            <tr>
              <td>{{even['time']}}</td>
              {% if even['priority'] == 'G' %}
              <td class="text-success"><i class="fa fa-smile-o"></i>
                {% elif even['priority'] == 'O' %}
              <td class="text-warning"><i class="fa fa-exclamation-circle"></i>
                {% elif even['priority'] == 'R' %}
              <td class="text-danger"><i class="fa fa-warning"></i>
                {% else %} <!-- B and default -->
              <td class="text-info"><i class="fa fa-info-circle"></i>
                {% endif %}
                {{even['desc']}}
              </td>
              <td><a href="{{url_for('dashboard',
                     section='networks', id='default')}}#net-{{even['net'][0]}}">{{even['net'][1]}}</a></td>
            </tr>
            {% endfor %}
          <tbody>
        </table>
      </dd>
      {% endfor %}
      {% endif %}
    </dl>
    {% endif %}
    <!-- END TIMELINE -->
    
    {% elif section == 'networks' %}
    <br>
    <div class="col-md-12">
      {% if neterrors %}
      <div id="neterrors" class="alert alert-danger" role="alert">
        <span class="glyphicon glyphicon-exclamation-sign"
              aria-hidden="true"></span>
        <span class="sr-only">Invalid or empty fields on form.</span>
        <strong>Hey!</strong>
        Invalid or empty fields on form.
      </div>
      {% endif %}
      <button id="button-add-net"
              type="button" class="button-icon-collapse btn btn-primary"
              data-toggle="collapse"
              data-target="#collapse-add-net" aria-expanded="false"
              aria-controls="collapse-add-net">
        <span id="icon-collapse-pa" class="fa fa-plus-square"
              aria-hidden="true"></span> Add network
      </button>  
    </div>
    <!-- collapse add net-->
    <div class="collapse col-md-8" id="collapse-add-net">
      <br>
      <div class="well">
        <h4><i class="fa fa-wifi"></i> New network</h4>
        {{wtf.quick_form(faddnet)}}
      </div>
    </div>
    <!-- end  add net-->
    <div class="col-md-12">
      <h4>My networks</h4>
    </div>
    {% if nets|length == 0 %}
    <br>
    <div class="col-md-12">
      <div class="alert alert-info" role="alert">
        <span class="glyphicon glyphicon-exclamation-sign"
              aria-hidden="true"></span>
        <span class="sr-only">Hey! You don't have networks</span>
        <strong>Hey!</strong>
        You don't have networks, please add one.
      </div>
    </div>
    {% else %}
    <hr>
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="panel-group" id="accordion-nets" role="tablist"
           aria-multiselectable="true">
        {% for net in nets %}
        <div class="panel panel-default" id={{'net-'~net['id']}}>
          <div class="panel-heading" role="tab" id="{{'net-'~net['id']~'tab'}}">
            <h4 class="panel-title">
              <a role="button" class="collapsed" data-toggle="collapse"
                 data-parent="#accordion" href="{{'#collapse-net-'~net['id']}}"
                 aria-expanded="false"
                 aria-controls="{{'collapse-net-'~net['id']}}">
                <span><i class="fa fa-wifi"></i></span> {{net['name']}}
              </a>
            </h4>
          </div>
          <div id="{{'collapse-net-'~net['id']}}" class="panel-collapse collapse"
               role="tabpanel" aria-labelledby="{{'net-'~net['id']~'tab'}}">
            <div class="panel-body">
              <h5><strong>General</strong></h5>
              <table class="table">
                <tbody>
                  <tr>
                    <td>Interface</td>
                    <td>Hardware Address</td>
                    <td>Speed</td>
                    <td>Security</td>
                  </tr>
                  <tr>
                    <td>{{net['interface']}}</td>
                    <td>{{net['hard-address']}}</td>
                    <td>{{net['speed']}}</td>
                    <td>{{net['security']}}</td>
                  </tr>
                </tbody>
              </table>
              <hr>
              <h5><strong>Buoy IPv4 info</strong></h5>
              <table class="table">
                <tbody>
                  <tr>
                    <td>Address</td>
                    <td>Subnet Mask</td>
                    <td>Default Route</td>
                    <td>Primary DNS</td>
                    <td>Secondary DNS</td>
                  </tr>
                  <tr>
                    <td>{{net['address']}}</td>
                    <td>{{net['subnet-mask']}}</td>
                    <td>{{net['default-route']}}</td>
                    <td>{{net['dns-1']}}</td>
                    {% if net['dns-2']|length == 0 %}
                    <td>-</td>
                    {% else %}<td>{{net['dns-2']}}</td>{% endif %}
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="panel-footer">
              <div class="pull-right">
                <button class="btn btn-warning"
                        type="button"
                        onclick="deleteNetwork('{{net['id']}}');">
                  <span class="glyphicon glyphicon-remove"></span> Remove
                </button>
                <button class="btn btn-default"
                        type="button">
                  <span class="glyphicon glyphicon-repeat"></span> Rescan
                </button>
              </div>
              <div class="clearfix"></div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      <br>
    </div>
    {% endif %}
    
    {% elif section == 'alerts' %}
    <div class="col-md-12">
      <br>
      <div class="panel panel-danger">
        <div class="panel-heading"><i class="fa fa-warning"></i>
          <strong>Unknown host detected</strong>
        </div>
        <div class="panel-body">
          <div class="col-md-6">
            <div class="table-responsive">
              <table class="table">
                <tbody>
                  <tr><td><strong>Hostname</strong></td><td>H4x0r</td></tr>
                  <tr><td><strong>IP</strong></td><td>192.168.1.25</td></tr>
                  <tr><td><strong>MAC</strong></td><td>00:0a:95:9d:68:16</td></tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-md-6">
            
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel panel-warning">
        <div class="panel-heading"><i class="fa fa-exclamation-circle"></i>
          <strong>Vulnerable host</strong>
        </div>
        <div class="panel-body">
          <div class="col-md-6">
            <div class="table-responsive">
              <table class="table">
                <tbody>
                  <tr><td><strong>Hostname</strong></td><td>XPS</td></tr>
                  <tr><td><strong>IP</strong></td><td>192.168.1.36</td></tr>
                  <tr><td><strong>MAC</strong></td><td>0b:0a:95:9d:68:14</td></tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-md-6">
            <a
               href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-100001">
              CVE-2014-100001</a> Remote code injection.
          </div>
        </div>
      </div>
    </div>
  </div>
  {% elif section == 'wblists' %}
  <br>
  <div class="col-md-12">
    {% if entryerrors %}
    <div id="entryerrors" class="alert alert-danger" role="alert">
      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
      <span class="sr-only">Invalid or empty fields on form.</span><strong>Hey!</strong>
      Invalid or empty fields on form.
    </div>
    {% endif %}
    <button id="button-add-entry"
            type="button" class="button-icon-collapse btn btn-primary" data-toggle="collapse"
            data-target="#collapse-add-entry" aria-expanded="false"
            aria-controls="collapse-add-entry">
      <span id="icon-collapse-pa" class="fa fa-plus-square"
            aria-hidden="true"></span> New list entry
    </button>  
  </div>
  <!-- collapse add entry-->
  <div class="collapse col-md-8" id="collapse-add-entry">
    <br>
    {% if canacl %}
    <div class="well clearfix">
      <h4><i class="fa fa-list"></i> Add entry</h4>
      <form class="form" role="form" method="post">
        {% if inconsistent %}
        <div class="alert alert-danger" role="alert">
          <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
          <span class="sr-only">You need to add a network</span><strong>Error!</strong>
          This entry is inconsistent with the previous rules. Please revise it.
        </div>
        {% endif %}
        {{wtf.form_field(faddentry.mac)}}
        <div class="form-group">
          <label class="control-label" for="add-entry-f-networks">
            Select the list type
          </label>
          {{faddentry.type(class_="form-control selectpicker")}}
        </div>
        <div {% if entryneterror %}
             class="form-group has-error" {% else %} class="form-group" {% endif %}>
          <label for="add-entry-f-networks"
                 {% if entryneterror %}
                 class="control-label text-danger"
                 {% else %}
                 class="control-label"
                 {% endif %}
                 >
            Select one or more networks
          </label>
          {{faddentry.networks(class_="form-control selectpicker")}}
        </div>
        {{faddentry.submit(class_="btn btn-default ")}}
      </form>
    </div>
    {% else %}
    <div class="alert alert-warning" role="alert">
      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
      <span class="sr-only">You need to add a network</span><strong>Hold on!</strong>
      You need to
      <a href="{{url_for('dashboard', section='networks', id='default')}}">add a network</a>
      before creating an W/B list entry.
    </div>
    {% endif %}
  </div>
  <hr>
  <!-- end  add entry-->
  <div class="col-md-12">
    <h4>My white &amp; black lists</h4>
  </div>
  <!-- white list -->
  {% if acls is none or acls.keys()|length == 0 or acls['W']|length == 0 %}
  <div class="col-md-12">
    <div class="alert alert-info" role="alert">
      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
      <span class="sr-only">Hey! You don't have white lists</span><strong>Empty! </strong>
      Your white list is empty, please add an entry.
    </div>
  </div>
  {% else %}
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span><i class="fa fa-file-text-o"></i></span>
        <strong>White list</strong>
      </div>
      <div class="panel-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <td><strong>Hostname</strong></td>
                <td><strong>MAC</strong></td>
                <td><strong>Address</strong></td>
                <td><strong>Network/s</strong></td>
                <td></td>
              </tr>
            </thead>
            <tbody>
              {% if acls['W']|length == 0 %}
              <td>-</td><td>-</td><td>-</td><td>-</td><td>-</td>
              {% else %}
              {% for entry in acls['W'] %}
              <tr>
                <td>{{entry['host'] if entry['host'] is not none else '-'}}</td>
                <td>{{entry['mac']}}</td>
                <td>{{entry['address'] if entry['host'] is not none else '-'}}</td>
                <td><ul class="list-inline">
                    {% for id, name in entry['nets'] %} 
                    <li><a href="{{url_for('dashboard',
                           section='networks', id='default')}}#net-{{id}}">{{name}}</a></li>
                    {% endfor %}
                </ul></td>
                <td><button class="btn btn-default btn-sm" type="button">
                    <span class="fa fa-edit"></span> Edit
                  </button> <button class="btn btn-default btn-sm" type="button">
                    <span class="fa fa-remove"></span> Delete
                </button></td>
              </tr>
              {% endfor %}
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div><!-- default -->
  </div><!-- col-md- 12 -->
  {% endif %}
  <!-- end white list -->
  <!-- black list -->
  {% if acls is none or acls.keys()|length == 0 or acls['B']|length == 0 %}
  <div class="col-md-12">
    <div class="alert alert-info" role="alert">
      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
      <span class="sr-only">Hey! You don't have black lists</span><strong>Empty!</strong>
      Your black list is empty, please add an entry.
    </div>
  </div>
  {% else %}
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span><i class="fa fa-file-text"></i></span>
        <strong>Black list</strong>
      </div>
      <div class="panel-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <td><strong>Hostname</strong></td>
                <td><strong>MAC</strong></td>
                <td><strong>Address</strong></td>
                <td><strong>Network/s</strong></td>
                <td></td>
            </thead>
            <tbody>
              {% if acls['B']|length == 0 %}
              <td>-</td><td>-</td><td>-</td><td>-</td><td>-</td>
              {% else %}
              {% for entry in acls['B'] %}
              <tr>
                <td>{{entry['host'] if entry['host'] is not none else '-'}}</td>
                <td>{{entry['mac']}}</td>
                <td>{{entry['address'] if entry['host'] is not none else '-'}}</td>
                <td><ul class="list-inline">
                    {% for id, name in entry['nets'] %} 
                    <li><a href="{{url_for('dashboard',
                           section='networks', id='default')}}#net-{{id}}">{{name}}</a></li>
                    {% endfor %}
                </ul></td>
                <td><button class="btn btn-default btn-sm" type="button">
                    <span class="fa fa-edit"></span> Edit
                  </button> <button class="btn btn-default btn-sm" type="button">
                    <span class="fa fa-remove"></span> Delete
                </button></td>
              </tr>
              {% endfor %}
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div><!-- default -->
  </div><!-- col-md- 12 -->
  {% endif %}
  <!-- end black list -->
  {% elif section == 'scans' %}
  {% elif section == 'stats' %}
  <div class="col-md-12">
    <h4>Weekly statistics</h4>
  </div>
  <div class="col-md-6">
    <h5>Events by type</h5>
    <div id="ned-comp" class="alert alert-info" role="alert"
         style="display: none">
      <strong>Ups!</strong> We haven't events to show the type distribution.
    </div>
    <div id="loading-tweek">
      <i class="fa fa-2x fa-spinner fa-pulse"></i>
    </div>
    <div class="col-md-4 chart-legend" id="tweek-legend">
    </div>
    <div class="col-md-2">
      <canvas id="can-tweek" width="250" height="250"></canvas>
    </div>  
  </div>
  <div class="col-md-6">
    <h5>Events by network</h5>
    <div id="ned-comp" class="alert alert-info" role="alert"
         style="display: none">
      <strong>Ups!</strong> We haven't events to show the distribution.
    </div>
    <div id="loading-nweek">
      <i class="fa fa-2x fa-spinner fa-pulse"></i>
    </div>
    <div class="col-md-4 chart-legend" id="nweek-legend">
    </div>
    <div class="col-md-2">
      <canvas id="can-nweek" width="250" height="250"></canvas>
    </div>  
  </div>
  <div class="col-md-12">
    <h4>Daily statistics</h4>
  </div>
  <div class="col-md-6">
    <h5>Event types by day</h5>
    <div id="ned-comp" class="alert alert-info" role="alert"
         style="display: none">
      <strong>Ups!</strong> We haven't events to show the distribution.
    </div>
    <div id="loading-tday">
      <i class="fa fa-2x fa-spinner fa-pulse"></i>
    </div>
    <div class="col-md-4 chart-legend" id="tday-legend">
    </div>
    <div class="col-md-2">
      <canvas id="can-tday" width="250" height="250"></canvas>
    </div>  
  </div>
  {% endif %}
</div>
</div>
{% endblock %}
